<div class="table-controls">
  <input
    type="text"
    placeholder="Search contacts..."
    [(ngModel)]="searchTerm"
    (input)="onSearchChange()"
  />
</div>

<table>
  <thead>
    <tr>
      <th title="Sort by name" (click)="sortBy('name')">Name</th>
      <th title="Sort by date of birth" (click)="sortBy('dateOfBirth')">Date of Birth</th>
      <th title="Sort by marital status" (click)="sortBy('isMarried')">Married</th>
      <th title="Sort by phone" (click)="sortBy('phone')">Phone</th>
      <th title="Sort by salary" (click)="sortBy('salary')">Salary</th>
      <th colspan="2"></th>
    </tr>
  </thead>
  <tbody>
    @for (contact of displayedContacts; track $index) {
      <tr>
      @if (editingContactId === contact.id) {
        <ng-container>
          <!-- Edit Mode -->
          <td><input [(ngModel)]="editedContact!.name"
                     required
                     maxlength="100"
                     #nameCtrl="ngModel" />
            @if (nameCtrl.invalid && nameCtrl.touched) {
              <div class="error">
                Name is required.
              </div>
            }
          </td>
          <td><input type="date"
                     [(ngModel)]="editedContact!.dateOfBirth"
                     required
                     #dobCtrl="ngModel" />
            @if (dobCtrl.invalid && dobCtrl.touched) {
              <div class="error">
                Date of birth is required.
              </div>
            }
          </td>
          <td><input type="checkbox"
                     [(ngModel)]="editedContact!.isMarried" />
          </td>
          <td><input [(ngModel)]="editedContact!.phone"
                     required
                     pattern="^[0-9+\- ]+$"
                     #phoneCtrl="ngModel" />
            @if (phoneCtrl.invalid && phoneCtrl.touched) {
              <div class="error">
                Phone number is invalid.
              </div>
            }
          </td>
          <td><input type="number"
                     [(ngModel)]="editedContact!.salary"
                     min="0"
                     max="1000000000"
                     #salaryCtrl="ngModel" />
            @if (salaryCtrl.invalid && salaryCtrl.touched) {
              <div class="error">
                Salary must be between 0 and 1,000,000,000.
              </div>
            }
          </td>
          <td class="button-group">
            <button class="save-button" (click)="saveEdit()">Save</button>
            <button class="cancel-button" (click)="resetEditingContact()">Cancel</button>
          </td>
          <td>
            <button title="Delete contact" class="delete-button" (click)="deleteContact(contact.id)">Delete</button>
          </td>
        </ng-container>
      }
      @else {
        <ng-container *ngTemplateOutlet="viewMode"></ng-container>
      }
      

      <ng-template #viewMode>
        <!-- View Mode -->
        <td>{{ contact.name }}</td>
        <td>{{ contact.dateOfBirth | date }}</td>
        <td>{{ contact.isMarried ? 'Yes' : 'No' }}</td>
        <td>{{ contact.phone }}</td>
        <td>{{ contact.salary | number }}</td>
        <td>
          <button title="Edit contact" class="edit-button" (click)="startEdit(contact)">Edit</button>
        </td>
        <td>
          <button title="Delete contact" class="delete-button" (click)="deleteContact(contact.id)">Delete</button>
        </td>
      </ng-template>
    </tr>
    }
  </tbody>
</table>

@if (!contacts || contacts.length === 0) {
  <div class="empty-table">
      No contacts available
  </div>
}